# データベースサービス
どんなデータにも最適な対応ができる万能なデータベースシステムはない  
重要なのは**適切なデータベースサービスを選択する**こと  
## RDS(Relational Database Service)
RDSを使うと簡単に**リレーショナルデータベース**を使用できる 
使用できるデータベースは以下の７つ
* Amazon Aurora
* MySQL
* PostgreSQL
* MAriaDB
* Oracle
* Microsoft SQL Server
* IBM DB2
RDSはオンプレミスで使われているデータベースエンジンをそのまま簡単にすることができる 

### RDSとEC2の違い
上記データベースエンジンのうちAmazon Aurora以外はEC2に各データベースエンジンをインストールして使用することが可能    
EC2にデータベースをインストールして使うことと、RDSを使用することの違いは管理タスクの違い
|管理タスク|オンプレ|EC2|RDS|
|:----:|:----:|:----:|:----:|
|アプリケーション最適化||||
|スケール|◯|◯|◯|
|高可用性|◯|◯|X|
|バックアップ|◯|◯|X|
|DBバッチ適用|◯|◯|X|
|DBインストール|◯|◯|X|
|OSバッチ適用|◯|◯|X|
|OSインストール|◯|X|X|
|サーバー管理|◯|X|X|
|ラッキング|◯|X|X|
|電源、空調、ネットワーク|◯|X|X|

※◯は必要、Xは不要   

このようにRDSでデータベースエンジンを使用することで、様々な管理タスクが不要になり、その分ユーザーはアプリケーションの開発に集中することができる。   
### メンテナンス  
RDSを使用すると週に1回ユーザーが指定した時間でOSのメンテナンスが自動的に行われる    
アップグレードがあった場合は自動適用するか否かユーザーが選択できる  


### バックアップ
RDSインスタンスを作成した時点でデフォルトで7日間の自動バックアップが適用される  
バックアップ期間は0~35日間まで設定でき、指定した時間にバックアップデータが作成される    
35日を超えてバックアップデータを保持したいときは、手動のスナップショットを作成できる    
※スナップショット：ある一時点のデータ状態を抜き出したもの。バックアップとは違いデータをコピーしているわけではないため、ディスク故障なので元データがなくなった場合、スナップショットを使って復旧することはできない。しかし状態を保存するだけなので、保存領域は少なくすみ、採取時間も数秒。スナップショットはDBインスタンスで復元することができる     

* 暗号化
RDSインスタンスは作成時に**AWS KMS**の暗号化キーにとって安全に暗号化できる  
暗号化されたインスタンスから作成されたスナップショットも同じ暗号化キーで暗号化される    

* ポイントタイムリカバリー
自動バックアップを設定している期間内であれば秒数まで指定して特定の自転のインスタンスに復元することが可能。これを**ポイントタイムリカバリー**と呼び、これはトランザクションログが保存されていることから可能になっている      

### 高可用性
DBサーバーも他のサーバーと同じようにいつ壊れてもおかしくないという**Design Failure**との設計原則に基づいて**単一障害点**とならないように設計しなければならない  
RDSの**マルチAZ配置**をオンにするとアベイラビリティゾーンを跨いだレプリケーションが自動で行われる   
Amazon Aurora, MySQL, PostgreSQL, MAriaDB, Oracle, SQL Serverでリードレプリカを作成でき、リードレプリカによって、プライマリの読み込み負荷を軽減することができる。これを**クロスリージョンリードレプリカ**という 

## Amazon Aurora
クラウドに最適化して再設計したリレーショナルデータベース    
MySQLとPostgreSQLと互換性があり、これらを利用しているアプリケーションはAuroraをそのまま使用できる可能性が高い   
Auroraを使用する主なメリットは以下のとおり
* 高い耐障害性と自己修復機能を持ったデータベースボリューム
* スタンバイにアクセスできる（リードレプリカがプライマリに昇格する）
* RDS MySOLと比べて5倍の性能
* ディスク容量を見込みで確保しなくても自動で増加する

## AWS Secrets Manager
データベース認証情報やAPIキーなどのシークレットを安全に保管し、EC2インスタンスやlambda関数などのアプリケーションから共有利用できるようにするサービス    
スケジュールに基づいて定期的にパスワードをローテーション（更新）する機能を備えている    
シークレットは`AWS KMS`によって安全に暗号化される     
RDSだけではないが、RDSと連携する場合が多い  
似たような使い方をするサービスに`System Manager パラメータストア`があるが、大きな違いはローテーションしない点。その分パラメータストアは無料で使用できる     

※`AWS KMS`：AWSのサービスやアプリケーションで使用する暗号化／復号化のためのキーを管理するサービス       
AWS KMSでは、KMSキーと呼ばれる暗号化／復号化のためのキーを作成、保管、使用、無効化、削除することができる

## DynamoDB
NoSQL型の高いパフォーマンスを持つフルマネージドのデータベースサービス（フルマネージド：ユーザーが管理する範囲がさらに少なくなる）   
データベースサーバーのOSやデータベースエンジン、テーブルの破損を気にしなくてよくなる    
DynamoDBを使用するときはテーブルの作成から始め、データベースサーバーとしてインスタンスを作成する必要がない      
最低限の設定ではテーブル名とプライマリキーを決めさえすれば使い始めることができる    
DynamoDBを使用するときにユーザーが選択するのはリージョンのみ。AZをユーザーが意識する必要は無い  
DynamoDBにテーブルを作って、そこに**アイテム**よ呼ばれるデータを保存すると、自動的に複数のAZの複数の施設で同期され、保存される。つまり**最初からマルチAZの構成になっている**

### DynamoDBの料金
データ容量は**無制限**で使用している容量が課金対象となる    
もう1つの料金はリクエストに対しての料金でこれには**プロビジョニング済みのキャパシティモード**と**オンデマンドキャパシティモード**から選択することができる   
* プロビジョニング済みキャパシティモード
書き込みと読み込みが1秒間で何回可能とするか（キャパシティユニット）の性能をユーザーが決めることができる 
このキャパシティユニットによって料金が算出される。またキャパシティユニットはオートスケールさせることができる        
* オンデマンドキャパシティモード
発生したリクエスト毎に料金が発生する    
プロビジョニング済みキャパシティモードのように毎秒毎のリクエスト数を決める必要がないので、リクエスト数が予測できない状況に対応できる    

#### DynamoDBとRDSの違い
### RDS
* システム：リレーショナルデータベース      
* 厳密な確定処理をすることに向いている（トランザクションをコミットにより確定できるため）
* スケーリング方法：垂直スケーリング（厳密な処理が得意、複雑なクエリ向き）
* SQL型のテーブル（列が固定で行に対してアクセス、SQLを使ってレコードにアクセス可能）

### DynamoDB
* システム：**非リレーショナルデータベース**や**NoSQL**   
* 大量のデータ更新や読み込みをする処理に向いている
* スケーリング方法：水平スケーリング（大量の処理が得意、大量のアクセスがあってもパフォーマンスを保てる）
* NoSQL型のテーブル（1つのデータは**アイテム**として扱い、キーとして設定している属性と値があれば、それ以外の属性は動的で自由）

## その他のデータベースサービス
### Amazon MemoryDB for Redis
インメモリデータベースシステムでRedisと互換性がある 
Redisの耐久性のあるプライマリデータベースとして使いたい場合使用する

### Amazon Neptune
フルマネージドグラフデータベース    
関係性や相関情報を扱う。SNS、レコメンデーションエンジン、経路案内、物流最適化などのアプリケーションに使用される 

# AI/ML、ビジネス、分析サービス
AWSには非常に多くのAI（人工知能）、ML(機械学習)サービスがある。多くのサービスは用意されたAPIにリクエストするだけで使用できるので、学習させたりモデルを作ったりという作業をせずにすぐ使用できる。    
全てのサービスはAPiにリクエストできて結果のレスポンスを受け取れます。リクエストはSDKで開発できるので、簡単にアプリケーションに組み込むことができる  
## Amazon Rekognition
画像と動画の分析ができます。写真に写っている人の顔の比較して、同一人物と思われるかを数値でレスポンスして同一人物かどうかを判定することができる。    
このような機能を使って学校行事の撮影写真から特定の生徒の写真だけを素早く集めたりするアルバムアプリケーションなどを作成することができる  
`Rekognition`には他に以下の機能があり、マネジメントコンソールのでもでも写真をアップロードして簡単に試せます     
* ラベル検出
写真に写っている道路や車などをラベルとして検出する
使用例：写真に自動タグ付して分類するアルバムアプリケーション
* 画像のもでレーション
暴力的、センシティブな写真を検出する
使用例：ユーザーによってアップロードされた写真の中に利用規約に違反した写真がないか自動検出する機能
* 顔の分析
顔写真から表情や年齢、性別などの見た目を数値化する
使用例：イベント会場で訪問者の年齢や笑顔度などを数値化して記録する機能
* 有名人の認識
有名人の写真を自動認識する
使用例：肖像権保護のために、有名人の写真が使用されていないかを検出する機能

## Amazon Comprehend
文章を分析する自然言語処理サービス  
文章が日本語や英語など、どの言語か自動検出したり文章に含まれる固有名詞やキーワードを抽出、検出したりできる  
文章の内容がネガティブかポジティブかを判断することができるので、クレームをいち早くみつけることもできる  

## Amazon polly
文章を音声に変換できる  
`Polly`を使えば読むことが困難な人に自動生成された音声を提供したり、オーディオマガジンなどを自動で作成したり、動的に返答してくる音声アシスタントや英会話アプリケーションなどを開発できる 

## Amazon Transcribe
`Polly`とは逆に音声をテキストに変換する 
カスタマーセンターで顧客の音声をテキストに変換して`Comprehend`で自動分析をしたり、自動議事録アプリケーションを開発できる    

## Amazon Translate
翻訳を行う  
翻訳前の言語がなにかは`Translate`が`comprehend`を呼び出して自動検出してくれる   

## Amazon Textract
手書き文書や印刷物からテキストを抽出するサービスで事前の設定はなにも必要ない    
手書きのアンケートや申込書などから文字を抽出して入力作業を楽にするアプリケーションの開発などができる