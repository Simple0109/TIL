# コードレビューに関する記事
## [Webアプリケーション(Rails)のコードレビューをする時に気にしている観点](https://qiita.com/ham0215/items/493d31b26497e4a671a4)
###  インデント
人が目視で確認するのは時間がもったいないし、漏れやブレが生じる
  - Rubocopの使用
  あとに回されがちだけど、途中からいれるのが大変だから、開発初期段階で導入することをすすめる

### HTTPのステータスコード
- 200系
リクエストが正常に処理したときのステータスコード
  - 201 Created
  POSTやPUTリクエストでリソースを生成したときに使用。返却がない場合は204 No Contentのほうがいいかも
  - 204 No Content
  DELETEリクエストでリソースを削除したときに使うことが多い。POSTやPUTなどでもレスポンスボディがないときも使う。これを使う場合レスポンスボディに値を入れてはいけない
  - 200 OK
  上記以外で正常なレスポンスを返すとき
- 300系
別ページへリダイレクトさせたいときのステータスコード
  - 301 Moves permanently
  恒久的に別のページにリダイレクトさせる場合。例えばWebページを移行した場合などに古いページのURLから新しいページへリダイレクトさせるときに使う。
  - 303 See other
  リソースを登録、更新させたあとに、そのリソースの詳細ページなどにリダイレクトさせる場合使う
  - 302 Found
  一時的に別のページにリダイレクトさせるとき。Railsでリダイレクトさせるとデフォルトで302になるが、リダイレクトさせる目的を考えると302の用途は少なく、301or303にしたほうがいい
- 400系
クライアント起因のエラーが発生した場合のステータスコード
  - 404 Not Found
  ページが見つからない場合に使われるステータスコード。
  - 401 Unauthorized
  認証が必要なアクションに対して有効な認証情報が渡されなかった場合に使用する
  - 403 Forbidden
  認証はしているが、利用権限が不足している場合に使用する。例えばあるリソースに対して読み取り専用のユーザーが更新を行おうとした場合などに使う。
  - 400 Bad request
  必須パラメーターが指定されていないなど不正なリクエストが来た場合に使用する。401, 403, 404に当てはまらないとき使うことが多い。
  - 410 Gone
  機関原意のキャンペーンページで期間が終了してページを削除したあとなど、恒久的に削除するURLにアクセスされたときに使う。
- 500系
サーバー起因のエラーが発生した場合のステータスコード
  - 501 Internal Server Error
  サーバーで予期せぬエラーがおきたときに使用する 
  - 503 Service Unavailable
  定期メンテナンスなどにより、一時的に正常にアクセスできずメンテナンスページを表示する場合に使う

### クライアントへのエラーメッセージが適切か
エラーが発生したとき、クライアントに返すメッセージが適切か確認すること

観点としてはそのエラーメッセージを受け取って次のアクションを起こせるかどうか
```shell
# エラー発生時メッセージ
"入力項目が不正です"
```
だとどの項目が間違っているのか、何をすればいいのかわからないので`xx項目の値は数値で入力してください`のような形で返すことが大事

### 配列の並び順が一意になるか
配列を返却する場合は、入れるの並び順が一意になるかチェックする
```ruby
# whereは配列の並び順はランダムなのでどのような順番で返ってくるのかわからない
def my_reviews(user_id)
  Review.where(user_id: user_id)
end

# 以下のようにorderメソッドを使って並び順を一意にする
def my_review(user_id)
  Review.where(user_id: user_id).order(created_at: :desc)
end

# 上記コードだと同じ時刻に生成されたレコードの場合の順番が一意にならないのでorderメソッドにidも含める
def my_review(user_id)
  Review.where(user_id: user_id).order(created_at: :desc, id: :desc)
```

## [フリーランス歴20年の強強エンジニアからのガチコードレビュー集](https://qiita.com/matsuken314/items/45430995ae0fa8d34231)
### migrationファイルを追加するとき【db:rollback】も考慮すること
マイグレーションファイルで`change`メソッドを用いてカラムを追加する場合などは`rails db:rollback`を実行しても自動的に問題なく前のマイグレーションファイルに戻る
```ruby
class AddDetailToUser < ActiveRecord::Migration[7.0]
  def change
    add_column :users, :detail, :string
  end
end
```
[Railsガイド](https://railsguides.jp/active_record_migrations.html#change%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BD%BF%E3%81%86)


- データ削除を伴う操作
  - カラム削除やテーブル削除など、データが永続的に失われる操作
  - 例：`remove_column`や`drop_table`のローロバック時には元データ構造や値を復元できない
- 自動ロールバックが不可能な変更
  - カラム型の変更（特にデータ変換を伴うもの）
  - テキスト型から数値型への変換など、データ整合性に影響する変更
- カスタムSQLやロジックを含む複雑な処理
  - `execute`メソッドを使用した生のSQL文の実行
  - 条件つきデータ変換や複雑なデータ移行
```ruby
def up
  # カラム削除
  remove_column :products, :description

  # カスタムSQLの発行
  execute "UPDATE users SET admin = 'false' WHERE admin IS NULL"
end

def down
  # 削除した絡むを復元する際には、型やデフォルト値を明示する必要がある
  add_column :products, :description, :text

  # カスタム操作のロールバック
  # ...
end
```

## [Railsアプリのコードレビューでよく指摘する点](https://bootcamp.fjord.jp/articles/36)
### 